var http = require ('http');
var qs = require('querystring');

var options = {
  host: 'baas.cloud.tilaa.com',
  port: 8080,
  path: '/rest/api/2/issue/',
  method: 'POST',
  headers: {'Authorization': 'Basic ' + new Buffer('admin' + ':' + 'Vaihda123__').toString('base64'),'Content-Type': 'application/json'}
};

process.server.on('request', function(request) {
  if(request.method === 'POST') {
	var body = '';

	request.on('data', function (data) {
		body += data;
	});
                        
	request.on('end', function () {
		var json = JSON.parse(body);

        	var summary = json.message;

        	console.log( summary );

        	// send ticket to jira
        	var req = http.request( options );

		var ticket = '{"fields": {"project": {"key": "BAAS"},"summary": "'+summary+'","issuetype": {"name": "Bug"},"description": "'+summary +'"}}\n';
        	req.write(ticket);
        	req.end();
	});

  }
});
